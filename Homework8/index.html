<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>


    <style>
        * {
            font-family: "Helevtice Neue";
        }
        
        p,
        text {
            font-size: 0.85em;
        }
        
        svg {
            background: #ffffff;
        }
    </style>

</head>

<body>
    <button id="2017">2017</button>
    <button id="combine">Combine</button>
    <div id="chart"></div>

    <script>
        (function() {
            var width = 1000,
                height = 1000;
            
            var svg = d3.select("#chart")
                .append("svg")
                .attr("height", height)
                .attr("width", width)
                .append("g")
                .attr("transform", "translate(0,0)")
            
            var radiusScale = d3.scaleSqrt().domain([1,1370000]).range([10,80])
            
            var simulation = d3.forceSimulation()
            .force("x",d3.forceX(function(d){
                return width/2}).strength(0.05))
            .force("y",d3.forceY(height/2).strength(0.05))
            .force("collide",d3.forceCollide(function(d){
                return radiusScale(d.records);
            }))
            
            d3.queue()
                .defer(d3.csv, "data.csv")
                .await(ready)
            function ready(error, datapoints) {
                var circles = svg.selectAll(".entity")
                    .data(datapoints)
                    .enter().append("circle")
                    .attr("class", "entity")
                    .attr("r", function(d){
                        return radiusScale(d.records);
                    })
                    .attr("fill", function(d) {
                                return d.colour} )
                
            var labels = svg.selectAll(".label")
                    .data(datapoints)
                    .enter().append("text")
                    .attr("class", "label")
                    .attr("text-anchor", "middle")
                    .attr("fill", "black")
                    .attr("font-size", "12px")
                    .attr("font-family", "Quicksand")
                    .text(function(d) {
                    return d.entity;
                    })
                    .style("visibility", function (d) {return d.entity === 1 ? "hidden" : "visible";})
                    .on("mouseover", function (d) {if (d.entity === 2) 
                        {node.filter(function (d) { return d.entity === 1; })
                        .style("visibility", "visible");}})
                    .on("mouseout", function (d) {if (d.entity === 2) 
                        {node.filter(function (d) { return d.entity === 1; })
                        .style("visibility", "hidden");}});
                
                d3.select("#2017").on("click"), function(){
                    console.log("You clicked me!")
                }
            
                simulation.nodes(datapoints)
                .on('tick', ticked)
                
                function ticked() {
                    circles
                    .attr("cx", function(d){
                        return d.x
                    })
                    .attr("cy", function(d){
                        return d.y
                    })
                    labels
                    .attr("x", function(d) {
                        return d.x
                    })
                    .attr("y", function(d) {
                       return d.y
                    })
                }
             
            }
        })();
        
    </script>
</body>

</html>
