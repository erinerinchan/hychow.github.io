<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>


    <style>
        * {
            font-family: "Helevtice Neue";
        }
        
        p,
        text {
            font-size: 0.85em;
        }
        
        svg {
            background: #f1f1f1;
        }
    </style>

</head>

<body>
    <div id="chart"></div>

    <script>
        (function() {
            var width = 1000,
                height = 1000;

            var svg = d3.select("#chart")
                .append("svg")
                .attr("height", height)
                .attr("width", width)
                .append("g")
                .attr("transform", "translate(0,0)")
            
            var radiusScale = d3.scaleSqrt().domain([1,1370000]).range([10,80])
            
            var simulation = d3.forceSimulation()
            .force("x",d3.forceX(width/2).strength(0.05))
            .force("y",d3.forceY(height/2).strength(0.05))
            .force("collide",d3.forceCollide(function(d){
                return radiusScale(d.records);
            }))

            d3.queue()
                .defer(d3.csv, "data.csv")
                .await(ready)

            function ready(error, datapoints) {

                var circles = svg.selectAll(".entity")
                    .data(datapoints)
                    .enter().append("circle")
                    .attr("class", "entity")
                    .attr("r", function(d){
                        return radiusScale(d.records);
                    })
                    .attr("fill", "lightblue")
                
            var labels = svg.selectAll(".label")
                    .data(datapoints)
                    .enter().append("text")
                    .attr("class", "label")
                    .attr("text-anchor", "middle")
                    .attr("fill", "black")
                    .attr("font-size", "12px")
                    .text(function(d) {
                    return d.entity;
                    .on("click", function(){
		                var active   = labels.active ? false : true ,
		  newOpacity = active ? 0 : 1;
		d3.select("#redLine").style("opacity", newOpacity);
		labels.active = active;
	})
                     })

                simulation.nodes(datapoints)
                .on('tick', ticked)
                
                function ticked() {
                    circles
                    .attr("cx", function(d){
                        return d.x
                    })
                    .attr("cy", function(d){
                        return d.y
                    })
                    labels
                    .attr("x", function(d) {
                        return d.x
                    })
                    .attr("y", function(d) {
                       return d.y
                    })
                }
             
            }
            
    </script>
</body>


</html>
